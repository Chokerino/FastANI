CXXFLAGS += -O3 -DNDEBUG -std=c++11 -Isrc/common -Isrc/cgi/include -Isrc/map/include -I @mathinc@
CPPFLAGS += @amcppflags@

UNAME_S=$(shell uname -s)

ifeq ($(UNAME_S),Darwin)
	CXXFLAGS += -mmacosx-version-min=10.7 -stdlib=libc++
else
	CXXFLAGS += -include src/common/memcpyLink.h -Wl,--wrap=memcpy
	CFLAGS += -include src/common/memcpyLink.h
endif

SOURCES=src/cgi/core_genome_identity.cpp

OBJECTS=$(SOURCES:.cpp=.o)  

all : mashcgi

mashcgi : $(OBJECTS) 
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(OBJECTS) -o mashcgi @mathlib@ -lstdc++ -lz -lm -lpthread  

.SUFFIXES :

%.o : %.cpp 
	$(CXX) -c $(CXXFLAGS) $(CPPFLAGS) -o $@ $<

%.o : %.c++
	$(CXX) -c $(CXXFLAGS) $(CPPFLAGS) -o $@ $<

install : mashcgi
	mkdir -p @prefix@/bin/
	cp `pwd`/mashmap @prefix@/bin/

clean :
	-rm -f mashcgi
	-rm -f src/cgi/*.o
